/*
 *
 *    Copyright (c) 2023 Project CHIP Authors
 *
 *    Licensed under the Apache License, Version 2.0 (the "License");
 *    you may not use this file except in compliance with the License.
 *    You may obtain a copy of the License at
 *
 *        http://www.apache.org/licenses/LICENSE-2.0
 *
 *    Unless required by applicable law or agreed to in writing, software
 *    distributed under the License is distributed on an "AS IS" BASIS,
 *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *    See the License for the specific language governing permissions and
 *    limitations under the License.
 */
package chip.devicecontroller

sealed class ClusterIDMapping {
  {%- for cluster in clientClusters | sort(attribute='code') %}
  object {{cluster.name}}: ClusterIDMapping() {
    {%- if cluster.attributes %}
    sealed class Attribute(val id: Long, val name: String) {
        {%- for attribute in cluster.attributes | sort(attribute='code') %}
            object {{attribute.definition.name | upfirst}}: Attribute({{attribute.definition.code}}L, "{{attribute.definition.name | upfirst}}")
        {%- endfor %}

      companion object {
        fun values(): List<Attribute> {
          return Attribute::class.sealedSubclasses.map { it.objectInstance!! }
        }

        @Throws(NoSuchFieldError::class)
        fun value(id: Long): Attribute {
          for (attribute in values()) {
            if (attribute.id == id) {
              return attribute
            }
          }
          throw NoSuchFieldError()
        }

        @Throws(IllegalArgumentException::class)
        fun valueOf(value: String): Attribute {
          for (attribute in values()) {
            if (attribute.name == value) {
              return attribute
            }
          }
          throw IllegalArgumentException()
        }
      }
    }
    {%- endif -%}

    {%- if cluster.events %}
    enum class Event(val id: Long) {
      {%- for event in cluster.events | sort(attribute='code') %}
        {{event.name | upfirst}}({{event.code}}L)
        {%- if loop.index0 < loop.length - 1 -%}{{", "}}{%- endif -%}
      {%- endfor -%};

      companion object {
        @Throws(NoSuchFieldError::class)
        fun value(id: Long): Event {
          for (event in Event.values()) {
            if (event.id == id) {
              return event
            }
          }
          throw NoSuchFieldError()
        }
      }
    }
    {%- endif -%}

    {%- if cluster.commands %}
    enum class Command(val id: Long) {
      {%- for command in cluster.commands | sort(attribute='code') %}
        {{command.name | upfirst}}({{command.code}}L)
        {%- if loop.index0 < loop.length - 1 -%}{{", "}}{%- endif -%}
      {%- endfor -%};

      companion object {
        @Throws(NoSuchFieldError::class)
        fun value(id: Long): Command {
          for (command in Command.values()) {
            if (command.id == id) {
              return command
            }
          }
          throw NoSuchFieldError()
        }
      }
    }
    {%- endif -%}

    {%- for command in cluster.commands | sort(attribute='code') %}
    {%- if command.input_param %}
    enum class {{command.name | upfirst}}CommandField(val id: Int) {
      {%- for field in (cluster.structs | named(command.input_param)).fields %}
        {{field.name | upfirst}}({{field.code}})
        {%- if loop.index0 < loop.length - 1 -%}{{", "}}{%- endif -%}
      {%- endfor -%};

      companion object {
        @Throws(NoSuchFieldError::class)
        fun value(id: Int): {{command.name | upfirst}}CommandField {
          for (field in {{command.name | upfirst}}CommandField.values()) {
            if (field.id == id) {
              return field
            }
          }
          throw NoSuchFieldError()
        }
      }
    }
    {%- endif -%}
    {% endfor %}

    override fun getID(): Long { return ID }

    {%- if cluster.attributes %}
    override fun getAttributeName(id: Long): String {
      return Attribute.value(id).toString()
    }
    {%- endif %}

    {%- if cluster.events %}
    override fun getEventName(id: Long): String {
        return Event.value(id).toString()
    }
    {%- endif %}

    {%- if cluster.commands %}
    override fun getCommandName(id: Long): String {
        return Command.value(id).toString()
    }
    {%- endif %}

    {%- if cluster.attributes %}
    override fun getAttributeID(name: String): Long {
      return Attribute.valueOf(name).id
    }
    {%- endif %}

    {%- if cluster.events %}
    override fun getEventID(name: String): Long {
      return Event.valueOf(name).id
    }
    {%- endif %}

    {%- if cluster.commands %}
    override fun getCommandID(name: String): Long {
      return Command.valueOf(name).id
    }
    {%- endif %}

    const val ID = {{cluster.code}}L
  }
  {%- endfor -%}

  companion object {
    fun getCluster(clusterId: Long): ClusterIDMapping? {
      {%- for cluster in clientClusters | sort(attribute='code') %}
      if (clusterId == {{cluster.name}}.ID) {
        return {{cluster.name}}
      }
      {%- endfor %}
      return null
    }
  }

  abstract fun getID(): Long

  @Throws(NoSuchFieldError::class)
  open fun getAttributeName(id: Long): String {
    throw NoSuchFieldError()
  }

  @Throws(NoSuchFieldError::class)
  open fun getEventName(id: Long): String {
    throw NoSuchFieldError()
  }

  @Throws(NoSuchFieldError::class)
  open fun getCommandName(id: Long): String {
    throw NoSuchFieldError()
  }

  @Throws(IllegalArgumentException::class)
  open fun getAttributeID(name: String): Long {
    throw IllegalArgumentException()
  }

  @Throws(IllegalArgumentException::class)
  open fun getEventID(name: String): Long {
    throw IllegalArgumentException()
  }

  @Throws(IllegalArgumentException::class)
  open fun getCommandID(name: String): Long {
    throw IllegalArgumentException()
  }
}